{"version":3,"file":"index.js","sources":["../src/utils/logger.ts","../src/rpc.ts","../src/worker/WorkerTransport.ts","../src/services/MintService.ts","../src/services/BalanceService.ts","../src/services/LightningService.ts","../src/services/RecoveryService.ts","../src/services/FederationService.ts","../src/FedimintWallet.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,null],"names":["logLevels","logger","constructor","level","this","setLevel","coerceLevel","includes","toLocaleUpperCase","log","message","args","logLevel","shouldLog","consoleFn","console","toUpperCase","debug","info","warn","error","messageLevel","levels","messageLevelIndex","indexOf","RpcClient","transportInit","requestCounter","requestCallbacks","Map","handleWorkerMessage","response","callback","get","request_id","initializeInner","transport","init","bind","initialize","initPromise","joinFederation","inviteCode","clientName","internalRpcSingle","type","invite_code","client_name","openClient","closeClient","undefined","internalRpcStream","request","onData","onError","onEnd","requestId","requestFull","set","data","delete","sendRequest","cancelRequest","cancel_request_id","Promise","resolve","reject","Error","rpcStream","module","method","body","payload","rpcSingle","cleanup","destroy","clear","_getRequestCounter","_getRequestCallbackMap","WebWorkerTransport","worker","postMessage","terminate","WebWorkerTransportInit","onRpcResponse","Worker","URL","url","onmessage","event","MintService","client","redeemEcash","notes","oob_notes","extra_meta","reissueExternalNotes","oobNotes","extraMeta","subscribeReissueExternalNotes","operationId","onSuccess","operation_id","spendNotes","amountMsats","tryCancelAfter","includeInvite","duration","nanos","secs","amount","try_cancel_after","include_invite","parseNotes","tryCancelSpendNotes","subscribeSpendNotes","res","awaitSpendOobRefund","getNotesByDenomination","BalanceService","getBalance","subscribeBalance","parseInt","LightningService","createInvoice","description","expiryTime","gatewayInfo","gateway","_getDefaultGatewayInfo","expiry_time","createInvoiceTweaked","tweakKey","index","user_key","scanReceivesForTweaks","indices","updateGatewayCache","gateways","listGateways","payInvoice","invoice","maybe_gateway","payInvoiceSync","timeoutMs","async","contract_id","fee","unsubscribe","subscribeLnPay","clearTimeout","timeoutId","success","feeMsats","preimage","unexpected_error","error_message","setTimeout","subscribeLnClaim","waitForPay","subscribeLnReceive","waitForReceive","getGateway","gatewayId","forceInternal","gateway_id","force_internal","RecoveryService","hasPendingRecoveries","waitForAllRecoveries","subscribeToRecoveryProgress","FederationService","getConfig","getFederationId","getInviteCode","peer","listOperations","DEFAULT_CLIENT_NAME","FedimintWallet","lazy","_openPromise","_resolveOpen","_isOpen","_client","mint","lightning","balance","federation","recovery","waitForOpen","open","e","isOpen","setLogLevel"],"mappings":"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"}