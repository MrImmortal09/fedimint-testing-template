{"version":3,"file":"worker.js","sources":["../src/worker/worker.js"],"sourcesContent":["// Web Worker for fedimint-client-wasm to run in the browser\n\n// HACK: Fixes vitest browser runner\n// TODO: remove once https://github.com/vitest-dev/vitest/pull/6569 lands in a release\nglobalThis.__vitest_browser_runner__ = { wrapDynamicImport: (foo) => foo() }\n\nlet rpcHandler = null\n\nconsole.log('Worker - init')\n\nself.onmessage = async (event) => {\n  if (event.data.type === 'init') {\n    try {\n      const { RpcHandler } = await import(\n        '@fedimint/fedimint-client-wasm-bundler'\n      )\n      rpcHandler = new RpcHandler()\n      self.postMessage({ type: 'init_success' })\n    } catch (err) {\n      console.error('Worker init failed:', err)\n      self.postMessage({ type: 'init_error', error: err.toString() })\n    }\n  } else {\n    // Check if rpcHandler is initialized before calling rpc\n    if (!rpcHandler) {\n      console.error('Worker: rpcHandler not initialized')\n      self.postMessage({ \n        type: 'error', \n        error: 'Worker not initialized. Call init first.' \n      })\n      return\n    }\n    \n    try {\n      rpcHandler.rpc(JSON.stringify(event.data), (response) =>\n        self.postMessage(JSON.parse(response)),\n      )\n    } catch (err) {\n      console.error('Worker RPC error:', err)\n      self.postMessage({ \n        type: 'error', \n        error: err.toString() \n      })\n    }\n  }\n}"],"names":["globalThis","__vitest_browser_runner__","wrapDynamicImport","foo","rpcHandler","console","log","self","onmessage","async","event","data","type","RpcHandler","import","postMessage","err","error","toString","rpc","JSON","stringify","response","parse"],"mappings":"AAIAA,WAAWC,0BAA4B,CAAEC,kBAAoBC,GAAQA,KAErE,IAAIC,EAAa,KAEjBC,QAAQC,IAAI,iBAEZC,KAAKC,UAAYC,MAAOC,IACtB,GAAwB,SAApBA,EAAMC,KAAKC,KACb,IACE,MAAMC,WAAEA,SAAqBC,OAC3B,0CAEFV,EAAa,IAAIS,EACjBN,KAAKQ,YAAY,CAAEH,KAAM,gBAC1B,CAAC,MAAOI,GACPX,QAAQY,MAAM,sBAAuBD,GACrCT,KAAKQ,YAAY,CAAEH,KAAM,aAAcK,MAAOD,EAAIE,YACxD,KACS,CAEL,IAAKd,EAMH,OALAC,QAAQY,MAAM,2CACdV,KAAKQ,YAAY,CACfH,KAAM,QACNK,MAAO,6CAKX,IACEb,EAAWe,IAAIC,KAAKC,UAAUX,EAAMC,OAAQW,GAC1Cf,KAAKQ,YAAYK,KAAKG,MAAMD,KAE/B,CAAC,MAAON,GACPX,QAAQY,MAAM,oBAAqBD,GACnCT,KAAKQ,YAAY,CACfH,KAAM,QACNK,MAAOD,EAAIE,YAEnB,CACA"}